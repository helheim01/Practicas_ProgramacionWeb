<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Enviar datos al Servlet</title>
    <!-- IMPORTACIÓN DE JQUERY: Hace que AJAX sea más fácil de escribir-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <h2>Formulario</h2>
    <!-- 
        PASOS PARA EJECUTAR:
        1. En IntelliJ, abrir el proyecto y poner en la consola: mvn clean package
        2. Esto, genera un WAR en la carpeta TARGET
        3. Ese WAR, debemos ponerlo en: C:\xampp\tomcat\webapps
        4. Levantar Tomcat, e ir en el navegador a: http://localhost:8080/servletproject/
    -->

    <input type="text" id="nombre" placeholder="Escribe tu nombre"> <!--$("#nombre") en jQuery se refiere a este input-->
    <input type="number" id="edad" placeholder="Tu edad">
    <button id="btnEnviar">Enviar</button> <!--$("#btnEnviar") en jQuery se refiere a este boton-->

    <div id="respuesta"></div>

    <!--JQUERY -->
    <script>
        $(document).ready(function() { //Espera a que la pagina cargue, y despues ejecuta el js
            $("#btnEnviar").click(function() { //al clickear el boton de antes, se activa la funcion

                // Rescato los valores ingresados
                let nombre = $("#nombre").val();
                let edad = $("#edad").val(); //En string, no numero

                // LLAMADA AJAX AL SERVLET
                $.ajax({  //AJAX: Asynchronous JavaScript And XML. El usuario envía datos y JS hace la peticion en segundo plano
                    url: "hola", //le añade el "hola" a la url, para que active el servlet
                    type: "GET", //Ejecutará doGet() en el servlet, para traer el saludo del servlet
                    data: { //datos que le envío (se convierten en parametros en la url -> /hola?nombre=Juan&edad=25)
                        //{ clave: valor, clave2: valor2 }
                        nombre: nombre, //nombre: nombre → ?nombre=Juan
                        edad: edad //edad: edad → &edad=25
                    },
                    
                    success: function(data) { //Se ejecuta cuando el servlet responde correctamente (código 200)
                        //El JSON que devuelve doGet(): {"mensaje":"Hola, Juan. Tienes 25 años."}
                        //jQuery automáticamente convierte JSON string a objeto JavaScript
                        
                        alert("Se llamó al servlet");
                        $("#respuesta").text(data.mensaje); //Encuentra el div con id "respuesta", borra el contenido actual y extrae el "mensaje" del JSON
                        //RESULTADO: El div ahora muestra: "Hola, Juan. Tienes 25 años."
                    },
                    
                    error: function() { //Cuando algo falla en la comunicación
                        alert("Algo anduvo mal");
                        $("#respuesta").text("Error en la petición.");
                    }
                });
                //Acá jQuery ejecuta la petición
            });
            //Acá el botón ya está "preparado" para responder clicks
        });
        
    </script>
 
</body>
</html>